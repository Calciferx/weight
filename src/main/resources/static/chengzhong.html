<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title></title>
    <!--第三方css-->
    <link rel="stylesheet" href="_plugin/layui/css/layui.css">
    <link rel="stylesheet" href="_plugin/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="_plugin/zTree/css/bootstrapStyle/bootstrapStyle.css">
    <!--自定义css-->
    <link rel="stylesheet" href="_css/main.css">
    <link rel="stylesheet" href="_css/chengzhong.css">
    <link rel="stylesheet" href="_css/font-some.css">
</head>

<body>

<div class="bodyGrid">
    <!--	操作按钮-->
    <operation>
        <div class="topBtn"></div>
    </operation>
    <!--	称重显示-->
    <weigh>
        <div class="container">
            <div class="box">
                <div class="chartNum">
                    <div class="cueLight">
                        <ul>
                            <li class="transBox"><span></span>传输</li>
                            <li class="stableBox"><span></span>稳定</li>
                        </ul>
                    </div>
                    <div class="box-items" id="TNum">
                        <li class="number-item"><span><i></i></span></li>
                    </div>
                    <li class="kgItem"><span><i>K</i></span></li>
                    <li class="kgItem"><span><i>g</i></span></li>
                </div>

                <div class="form-row">
                    <div class="col-6">
                        <div class="form-group form-row">
                            <label class="col-4 col-form-label">车牌号</label>
                            <div class="col-8">
                                <input class="form-control" name="plateNumber">
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group form-row">
                            <label class="col-4 col-form-label">毛重</label>
                            <div class="col-8">
                                <input class="form-control" name="roughWeight">
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group form-row">
                            <label class="col-4 col-form-label">供应商名称</label>
                            <div class="col-8">
                                <input class="form-control" name="supplierName">
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group form-row">
                            <label class="col-4 col-form-label">皮重</label>
                            <div class="col-8">
                                <input class="form-control" name="tareWeight">
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group form-row">
                            <label class="col-4 col-form-label">物料名称</label>
                            <div class="col-8">
                                <input class="form-control" name="materialName">
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group form-row">
                            <label class="col-4 col-form-label">净重</label>
                            <div class="col-8">
                                <input class="form-control" name="netWeight">
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group form-row">
                            <label class="col-2 col-form-label">备注</label>
                            <div class="col-10">
                                <input class="form-control" name="comment">
                            </div>
                        </div>
                    </div>
                </div>
                <footer>
                    <div class="btnBar">
                        <div class="btn-group">
                            <button class="btn_insert1" lay-submit lay-filter="btn_insert1">保存</button>
                        </div>
                        <div class="btn-group">
                            <!--							<button class="btn_dataCof" lay-submit lay-filter="btn_dataCof">取数</button>-->
                        </div>
                        <div class="btn-group">
                            <button class="btn_cancel">清空</button>
                        </div>
                    </div>
                </footer>
            </div>

        </div>
    </weigh>

    <!--	操作面板-->
    <panel> <!--过磅选择-->
        <div class="typeBox">
            <div class="WeighingType">
                <form>
                    <div>过磅类型:</div>
                    <input class="typeBtn" type="radio" value="1" id="type1">
                    <label for="type1">采购</label><br>
                    <input class="typeBtn" type="radio" value="2" id="type2">
                    <label for="type2">销售</label><br>
                    <input class="typeBtn" type="radio" value="3" id="type3">
                    <label for="type3">内部</label><br>
                    <input class="typeBtn" type="radio" value="4" id="type4">
                    <label for="type4">其他</label><br>
                </form>
            </div>

            <div class="WeighingMode">
                <form>
                    <div>过磅模式:</div>
                    <input class="typeBtn" type="radio" value="5" id="type5"> <label
                        for="type5">标准过磅</label><br> <input class="typeBtn"
                                                                type="radio" value="6" id="type6"><label
                        for="type6">一次过磅</label>
                    <br>
                    <!--					<input class="typeBtn" type="radio" value="3" id="type3"><label for="type3">内部过磅</label> <br>-->
                    <!--					<input class="typeBtn" type="radio" value="4" id="type4"><label for="type4">其他过磅</label> <br>-->
                </form>
            </div>
            <div class="WeighingStatus">
                <form>
                    <div>状态:</div>
                    <ul>
                        <li><span class="beforeInfr1"></span>1-前车检</li>
                        <li><span class="beforeInfr2"></span>1-前计量</li>
                        <li><span class="afterInfr1"></span>2-后计量</li>
                        <li><span class="afterInfr2"></span>2-后车检</li>

                        <!--						<li><span></span>前地感</li>-->
                        <!--						<li><span></span>后地感</li>-->
                    </ul>
                </form>
            </div>
        </div>

        <!--手动操作-->
        <div class="handBox">
            <div class="pilotLamp">
                <div>红绿灯</div>
                <button class="btn btn_device" data-type="TRAFFIC_LIGHT_RED">
                    <span style="background-color: #af0000"></span>红灯
                </button>
                <button class="btn btn_device" data-type="TRAFFIC_LIGHT_GREEN">
                    <span style="background-color: #00B83F"></span>绿灯
                </button>
            </div>
            <div class="beforeBrake">
                <div>前道闸</div>
                <button class="btn btn_beforePole btn_device" data-type="FRONT_BARRIER_ON">
                    <i class="fa fa-arrow-up fa-lg"></i>起杆
                </button>
                <button class="btn btn_beforePole btn_device" data-type="FRONT_BARRIER_OFF">
                    <i class="fa fa-arrow-down fa-lg"></i>落杆
                </button>
            </div>
            <div class="AfterBrake">
                <div>后道闸</div>
                <button class="btn btn_afterPole btn_device" data-type="BACK_BARRIER_ON">
                    <i class="fa fa-arrow-up fa-lg"></i>起杆
                </button>
                <button class="btn btn_afterPole btn_device" data-type="BACK_BARRIER_OFF">
                    <i class="fa fa-arrow-down fa-lg"></i>落杆
                </button>
            </div>
        </div>
        <!--        <div class="video-container">-->
        <!--            <div class="flv-container"></div>-->
        <!--        </div>-->
        <!--        <div class="video-container">-->
        <!--            <div class="flv-container"></div>-->
        <!--        </div>-->
        <div class="AutoWeighing">
            <div>
                <input class="typeBtn" type="checkbox" value="7" id="type7">
                <label for="type7">自动过磅</label><br>
            </div>
            <div>
                <button class="btn btn-info btn_reset">初始化设备</button>
            </div>
        </div>

        <!--日志-->
        <div class="infoRecord">
            <div class="messageBox">
                <!--<div class="infoContent">
                    <span>2021-08-25 09:26:00 车辆开始称重</span>
                </div>-->
            </div>
        </div>
    </panel>

    <!--	信息记录-->
    <dataTable>
        <div class="divInsert" id="bodyInsert">
            <table class="table table-bordered table-sm tableDiy"
                   id="tableInsert">
                <thead class="thead-light">
                <tr>
                    <th>序号</th>
                    <th>检斤编号</th>
                    <th>供应商名称</th>
                    <th>物料名称</th>
                    <th>车牌号</th>
                    <th>毛重</th>
                    <th>皮重</th>
                    <th>净重</th>
                    <th>检斤日期</th>
                    <th>检斤状态</th>
                    <th>是否打印</th>
                    <th>受控编号</th>
                    <th>备注</th>
                    <th>检斤员</th>
                    <th>审核员</th>
                    <th>是否化验</th>
                    <th>车辆类型</th>
                </tr>
                </thead>
                <tbody>

                </tbody>
                <tfoot>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td class="roughWeight"></td>
                    <td class="tareWeight"></td>
                    <td class="netWeight"></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="2">
                        <select class="form-control custom-select" data-id="recordType" lay-ignore>
                            <!--						<option value="">所有</option>-->
                            <option value="1">本日记录</option>
                            <!--						<option value="2">本周记录</option>-->
                            <!--						<option value="3">本月记录</option>-->
                            <!--						<option value="4">本季记录</option>-->
                            <!--						<option value="5">本年记录</option>-->
                        </select>
                    </td>
                    <td colspan="2">
                        <select class="form-control custom-select" data-id="logType" lay-ignore>
                            <option value="">全部记录</option>
                            <option value="1">未完成记录</option>
                            <option value="2">已完成记录</option>
                        </select>
                    </td>
                    <!--&lt;!&ndash;<td></td>
                    <td></td>&ndash;&gt;
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>-->
                </tr>
                </tfoot>
            </table>
        </div>
    </dataTable>
</div>
<!--审批弹框-->
<form class="layui-form layerForm" id="formVerify" lay-filter="formVerify">
    <main>
        <div class="form-row">
            <div class="col-12">
                <p>该用户没有配置从机设备，无法进行称重;请先配置从机设备</p>
            </div>
        </div>
    </main>

    <footer>
        <div class="btnBar">
            <div class="btn-group">
                <button class="btn btn_submit">确定</button>
            </div>
        </div>
    </footer>
</form>
<!--第三方js-->
<script src="_plugin/layui/layui.all.js"></script>
<script src="_plugin/layui/lay/modules/laydate.js"></script>
<script src="_plugin/jquery/jquery-3.3.1.min.js"></script>
<script src="_plugin/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="_plugin/moment/moment.min.js"></script>
<script src="_plugin/echarts/echarts.min.js"></script>
<script src="_plugin/zj/zMath.js"></script>
<script src="_plugin/jessibuca/jessibuca.js"></script>
<!--自定义js-->
<script src="_js/main.js"></script>

<script>
    // 一进页面自动勾选上自动过磅
    $('#type7').prop('checked', true)
    $('.box .form-control').prop('disabled', true)
    $('.handBox .btn,.btn_cancel,.btn_insert1,.btn_dataCof').prop('disabled', true)
    getScrool()

    function getScrool() {  // 滚动条始终在最下面
        let top = $(".messageBox")[0].scrollHeight;
        $(".messageBox").scrollTop(top);
    }

    /*websocket*/
    let ws_url = location.origin.replace('http', 'ws') + '/weightproject/websocket/socketServer.do?' + loginId
    //let ws_url = location.origin.replace('http', 'ws') + '/mdwisdomstore/websocket/socketServer.do?' + loginId
    // let ws_url = 'http://192.168.1.217:8080/weightproject/websocket/socketServer.do?userId=' + loginId
    let ws = null           //ws实例

    ws_init()
    setInterval(() => {   //20秒轮询
        if (ws.readyState == 1) {
            ws.send('heartCheck')   //正常则发送心跳
        } else {
            ws_init()   //断开则初始化
        }
    }, 20000)


    function ws_init() {    //初始化
        ws = new WebSocket(ws_url)
        ws.onopen = ws_onopen         //连接
        ws.onmessage = ws_onmessage   //接收
        // ws.onclose = ws_onclose       //断开
        // ws.onerror = ws_onerror       //错误
    }

    function ws_onopen() {
        console.log('ws连接成功')
    }

    function ws_onmessage(e) {
        console.log(e)

        let data = JSON.parse(e.data)
        //let result = JSON.parse(e.result)
        if (data.type == '1111') {  //初始信息(首次返回的消息)
            console.log('连接成功')
        } else if (data.type == '1') {  //前红外线1---北车检---状态显示
            if (data.data == false) {
                $('.WeighingStatus .beforeInfr1').css('background-color', '#A60000')
            } else if (data.data == true) {
                $('.WeighingStatus .beforeInfr1').css('background-color', '#00B83F')
            }
        } else if (data.type == '2') {  //前红外线2---北计量---状态显示
            if (data.data == false) {
                $('.WeighingStatus .beforeInfr2').css('background-color', '#A60000')
            } else if (data.data == true) {
                $('.WeighingStatus .beforeInfr2').css('background-color', '#00B83F')
            }
        } else if (data.type == '3') {  // 后红外1---南计量---状态显示
            if (data.data == false) {
                $('.WeighingStatus .afterInfr1').css('background-color', '#A60000')
            } else if (data.data == true) {
                $('.WeighingStatus .afterInfr1').css('background-color', '#00B83F')
            }
        } else if (data.type == '4') {  // 后红外2---南车检---状态显示
            if (data.data == false) {
                $('.WeighingStatus .afterInfr2').css('background-color', '#A60000')
            } else if (data.data == true) {
                $('.WeighingStatus .afterInfr2').css('background-color', '#00B83F')
            }
        } else if (data.type == '5') {  // 称重日志
            let div = `<div class="infoContent">
				<span>${data.data}</span>
				</div>`
            $('.messageBox').append(div)
            getScrool()
        } else if (data.type == '6') { // 车辆信息
            data.data.plateNumber && $('.container [name="plateNumber"]').val(data.data.plateNumber)  // 车牌号
            data.data.roughWeight && $('.container [name="roughWeight"]').val(data.data.roughWeight)  //毛重
            data.data.supplierName && $('.container [name="supplierName"]').val(data.data.supplierName)  //供应商名称
            data.data.tareWeight && $('.container [name="tareWeight"]').val(data.data.tareWeight) // 皮重
            data.data.materialName && $('.container [name="materialName"]').val(data.data.materialName)  // 物料名称
            data.data.netWeight && $('.container [name="netWeight"]').val(data.data.netWeight)  // 净重
            data.data.comment && $('.container [name="comment"]').val(data.data.comment)  // 备注
        } else if (data.type == '7') {  // 称重kg
            start(data.data.weightNum)
            if (data.data.status == '5553') {  // 传输
                $('.container .transBox span').css('background', 'linear-gradient(white, green)')
            } else {
                $('.container .transBox span').css('background', 'linear-gradient(white, red)')
            }
            if (data.data.status == '5354') {  // 稳定
                $('.container .stableBox span').css('background', 'linear-gradient(white, green)')
                if ($('#type7').prop('checked') == false && data.data.weightNum != '') {  //保存按钮
                    $('.btn_cancel,.btn_insert1,.btn_dataCof').prop('disabled', false)
                }
            } else {
                $('.container .stableBox span').css('background', 'linear-gradient(white, red)')
                if ($('#type7').prop('checked') == false) {  //保存按钮
                    $('.btn_cancel,.btn_insert1,.btn_dataCof').prop('disabled', true)
                }
            }
        } else if (data.type == '8') {  // 毛重、淨重、皮重
            $('.container [name="roughWeight"]').val(data.data.roughWeight)  //毛重
            $('.container [name="tareWeight"]').val(data.data.tareWeight)  // 皮重
            $('.container [name="netWeight"]').val(data.data.netWeight)  // 净重
        } else if (data.type == '9') {
            clearDashboard();
            getTables()
        } else if (data.type == '11') {  // 物料名称
            $('.container [name="materialName"]').val(data.data)  //物料名称
        } else if (data.type == '12') {  // 供应商名称
            $('.container [name="supplierName"]').val(data.data)  //供应商名称
        } else if (data.type == '0') { //导出成功

        }
    }

    function clearDashboard() {
        $('.container [name="plateNumber"]').val('')  // 车牌号
        $('.container [name="roughWeight"]').val('')  //毛重
        $('.container [name="supplierName"]').val('')  //供应商名称
        $('.container [name="tareWeight"]').val('') // 皮重
        $('.container [name="materialName"]').val('')  // 物料名称
        $('.container [name="netWeight"]').val('')  // 净重
        $('.container [name="comment"]').val('') // 备注
    }

    //页面关闭前
    /*onbeforeunload = function () {
        opener.$('#export').removeAttr('disabled')   //启用父级页面"导出"按钮
        ws.close()  //断开连接
    }*/

</script>
<script>
    //数字滚动
    var chartNum = ['0', '0', '0', '0', '0', '0'];     // 默认总数
    start('000000');

    function start(num) {
        console.log(num)
        var strHtml = "";
        for (var i = 0; i < chartNum.length; i++) {
            strHtml += `<li class="number-item">
				        <span><i class="item" ref="numberItem">0123456789</i></span></li>`;
        }
        $("#TNum").html(strHtml);
        toOrderNum(num);
        setNumberTransform();
        // 定时改变数字
        /*setInterval(function setInt() {
            toOrderNum('34534');
            setNumberTransform();
        }, 1000)*/
    }

    function toOrderNum(num) {
        num = num.toString()     // 数字变成字符串
        if (num.length < 6) {  // 如未满位数，添加"0"补位
            num = '0' + num
            toOrderNum(num) // 递归添加"0"补位
        } else if (num.length === 6) {      // 数中加入逗号
            // num = num.slice(0, 2) + ',' + num.slice(2, 5) + ',' + num.slice(5, 8)
            chartNum = num.split('') // 将其便变成数据
        } else {
            alert('显示异常');
        }
    }

    function setNumberTransform() {
        var numberItems = $('.item');
        const numberArr = chartNum.filter(item => !isNaN(item));
        for (var index = 0; index < numberItems.length; index++) {
            const elem = numberItems[index];
            elem.style.transform = 'translate(-50%, -' + numberArr[index] * 10 + '%)'
        }
    }

    //称重记录
    let dataType = {
        token,
    }
    $('#bodyInsert [data-id="recordType"]').change(function () {  // 记录查询
        dataType.recordType = $(this).find('option:checked').val()
        getTables()
    })

    $('#bodyInsert [data-id="logType"]').change(function () { // 记录查询
        dataType.completeStatus = $(this).find('option:checked').val()
        getTables()
    })
    dataType.startTime = moment().format('YYYY-MM-DD 00:00:00')
    dataType.endTime = moment().format('YYYY-MM-DD HH:mm:ss')

    // dataType.startTime = "2024-10-01 00:00:00"
    // dataType.endTime = "2024-10-07 00:00:00"
    getTables()

    function getTables() {
        $.post(
            'admin/weightRecord/query',
            dataType,
            res => {
                if (res.code != 1111) {
                    layer.msg(res.msg)
                    return false
                }
                let data = res.data
                $('#tableInsert tbody').empty()
                data.forEach(function (item, i) {
                    addRow()
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl1"]').val(item.id)  //序号
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl2"]').val(item.weighId)  //检斤编号
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl3"]').val(item.supplierName)  //供应商名称
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl4"]').val(item.materialName)  //物料名称
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl5"]').val(item.plateNumber)  //车牌号
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl6"]').val(item.roughWeight)  //毛重
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl7"]').val(item.tareWeight)  //皮重
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl8"]').val(item.netWeight)  //净重
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl9"]').val(item.weighDate)  //检斤日期
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl10"]').val(item.weighStatus)  //检斤状态
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl11"]').val(item.isPrint)  //是否打印
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl12"]').val(item.controlId)  //受控编号
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl13"]').val(item.comment)  //备注
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl14"]').val(item.weighMan)  //检斤员
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl15"]').val(item.auditor)  //审核员
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl16"]').val(item.isTest)  //是否化验
                    $('#tableInsert tbody tr').eq(i).find('[data-id="jl17"]').val(item.carType)  //车辆类型
                })
                totalAmount()
            }
        )
    }

    function addRow(i) {
        let row = `<tr>
				<td><input class="form-control disabled" disabled data-id="jl1" title="序号"/></td>
				<td><input class="form-control disabled" disabled data-id="jl2" title="检斤编号"/></td>
				<td><input class="form-control disabled" disabled data-id="jl3" title="供应商名称"/></td>
				<td><input class="form-control disabled" disabled data-id="jl4" title="物料名称"/></td>
				<td><input class="form-control disabled" disabled data-id="jl5" title="车牌号"/></td>
				<td><input class="form-control disabled" disabled data-id="jl6" title="毛重"/></td>
				<td><input class="form-control disabled" disabled data-id="jl7" title="皮重"/></td>
				<td><input class="form-control disabled" disabled data-id="jl8" title="净重"/></td>
				<td><input class="form-control disabled" disabled data-id="jl9" title="检斤日期"/></td>
				<td><input class="form-control disabled" disabled data-id="jl10" title="检斤状态"/></td>
				<td><input class="form-control disabled" disabled data-id="jl11" title="是否打印"/></td>
				<td><input class="form-control disabled" disabled data-id="jl12" title="受控编号"/></td>
				<td><input class="form-control disabled" disabled data-id="jl13" title="备注"/></td>
				<td><input class="form-control disabled" disabled data-id="jl14" title="检斤员"/></td>
				<td><input class="form-control disabled" disabled data-id="jl15" title="审核员"/></td>
				<td><input class="form-control disabled" disabled data-id="jl16" title="是否化验"/></td>
				<td><input class="form-control disabled" disabled data-id="jl17" title="车辆类型"/></td>
				</tr>`
        if (i == null) {
            $('#tableInsert tbody').append(row)
        } else {
            $('#tableInsert tbody tr').eq(i).after(row)
        }
        $('#tableInsert tbody .lineNumber').each(function (i) { //更新行号
            $(this).val(i + 1)
        })
    }

    //合计数量/金额
    function totalAmount() {
        let roughWeight = 0, tareWeight = 0, netWeight = 0
        //合计毛重
        $('#tableInsert tbody [data-id="jl6"]').each(function () {
            roughWeight = zMath.plus(roughWeight, $(this).val() * 1)
        })
        //合计皮重
        $('#tableInsert tbody [data-id="jl7"]').each(function () {
            tareWeight = zMath.plus(tareWeight, $(this).val() * 1)
        })
        //合计净重
        $('#tableInsert tbody [data-id="jl8"]').each(function () {
            netWeight = zMath.plus(netWeight, $(this).val() * 1)
        })
        $('#tableInsert tfoot .roughWeight').text(roughWeight.toFixed(toDecimal))  //毛重
        $('#tableInsert tfoot .tareWeight').text(tareWeight.toFixed(toDecimal)) //皮重
        $('#tableInsert tfoot .netWeight').text(netWeight.toFixed(toDecimal)) //净重
    }


    //初始化设备
    $('.btn_reset').click(function () {
        $.post(
            'admin/initSystem',
            {
                token,
            },
            res => {
                if (res.code != 1111) {
                    layer.msg(res.msg)
                    return false
                }
                layer.msg(res.msg)
            }
        )
    })


    //过磅类型选择
    $(".WeighingType input[type='radio']").click(function () {
        $(this).prop('checked', true)
        $(this).siblings().prop('checked', false)
        let val = $('input:radio:checked').val();
    });

    //过磅模式选择
    $(".WeighingMode input[type='radio']").click(function () {
        $(this).prop('checked', true)
        $(this).siblings().prop('checked', false)
        let val = $('input:radio:checked').val();
    });

    //是否自动过磅
    $('#type7').click(function () {
        // console.log($(this).prop('checked'))
        if ($(this).prop('checked') == true) {
            $('.box .form-control').prop('disabled', true)
            $('.handBox .btn,.btn_cancel,.btn_insert1,.btn_dataCof').prop('disabled', true)
        } else {
            $('.box .form-control').prop('disabled', false)
            $('.handBox .btn').prop('disabled', false)
        }
    })

    // 清空按钮
    $('.btn_cancel').click(function () {
        clearDashboard()
    })

    // 保存按钮
    $('.btn_insert1').click(function () {
        let field = {
            carNum: $('.container [name="carCode"]').val(), //车号
            type: 'PO', // 过磅类型
            faHuo: $('.container [name="address"]').val(), //发货单位
            shouHuo: $('.container [name="reAddress"]').val(), // 收货单位
            goodsName: $('.container [name="huoming"]').val(), // 货名
            spec: $('.container [name="guige"]').val(), // 规格
            userName: loginRealName,  // 录入人名称
        }
        field.token = token
        $.post(
            '../adminx/record/add.do',
            field,
            res => {
                if (res.code != 1111) {
                    layer.msg(res.msg)
                    return false
                }
                layer.msg(res.msg)
            }
        )
    })

    $('.btn_dataCof').click(function () {
        $('.container [name="maoZ"]').val(data.map.毛重)  //毛重
        $('.container [name="piZ"]').val(data.map.皮重)  // 皮重
        $('.container [name="jingZ"]').val(data.map.净重)  // 净重
    })

    if (loginSlaveList == '') {
        layer.open({
            type: 1,
            title: '信息',
            area: ['350px', '203px'], //宽高
            content: $('#formVerify')
        })
    }

    //返回
    $('.btn_submit').click(function () {
        layer.closeAll('page');
    })
    //道闸 起杆、落杆
    $('.btn_beforePole,.btn_afterPole').click(function () {
        let deviceName = $(this).attr('data-type')
        $.post(
            '/device/modbus/name',
            {
                token,
                deviceName
            },
            res => {
                layer.msg(res.msg)
            }
        )
    })
    // $.post(
    //     'device/wsURL',
    //     function (data) {
    //         createLive(data)
    //     }
    // )

    function createLive(addresses) {
        addresses.forEach((address, index) => {
            let player = create($('.flv-container')[index])
            player.play(address)
        })
    }

    // let player1 = create($('#container1')[0])
    // player1.play("ws://192.168.1.100:9080/ws.flv?token=d2805fca-d5c3-bf4b-2b0d-d49ce64f4f41&channel=0");
    function create(containerDom) {
        let jessibuca = new Jessibuca({
            decoder: '/_plugin/jessibuca/decoder.js',
            container: containerDom,
            videoBuffer: 0.2, // 缓存时长
            isResize: false,
            text: "",
            loadingText: "加载中",
            debug: true,
            showBandwidth: true, // 显示网速
            operateBtns: {
                fullscreen: true,
                screenshot: true,
                play: true,
                audio: true,
            },
            forceNoOffscreen: true,
            isNotMute: false,
        });

        jessibuca.onLog = msg => console.error(msg);
        jessibuca.onRecord = (status) => console.log('onRecord', status);
        jessibuca.onPause = () => console.log('onPause');
        jessibuca.onPlay = () => console.log('onPlay');
        jessibuca.onFullscreen = msg => console.log('onFullscreen', msg);
        jessibuca.onMute = msg => console.log('onMute', msg);

        return jessibuca
    }
</script>
</body>
</html>
